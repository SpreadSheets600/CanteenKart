{% extends 'base.html' %}
{% block title %}Owner Orders - CanteenKart{% endblock %}
{% block content %}
<h1>Active Orders</h1>
<table>
  <thead><tr><th>ID</th><th>User</th><th>Status</th><th>Actions</th></tr></thead>
  <tbody>
  {% for order in orders %}
    <tr>
      <td>{{ order.order_id }}</td>
      <td>{{ order.user.name if order.user else order.user_id }}</td>
      <td id="status-{{ order.order_id }}">{{ order.status }}</td>
      <td>
        <form action="{{ url_for('owner_orders.update_status', order_id=order.order_id) }}" method="post" style="display:inline">
          <select name="status">
            <option value="pending" {% if order.status=='pending' %}selected{% endif %}>pending</option>
            <option value="preparing" {% if order.status=='preparing' %}selected{% endif %}>preparing</option>
            <option value="ready" {% if order.status=='ready' %}selected{% endif %}>ready</option>
            <option value="completed" {% if order.status=='completed' %}selected{% endif %}>completed</option>
          </select>
          <button type="submit">Set</button>
        </form>
      </td>
    </tr>
  {% endfor %}
  </tbody>
</table>

{% if config.ENABLE_SOCKETIO %}
<script src="/socket.io/socket.io.js"></script>
<script>
  const socket = io();
  socket.on('connect', () => console.log('socket connected'));
  socket.on('new_order', (data) => {
    console.log('new_order', data);
    location.reload();
  });
  socket.on('order_update', (data) => {
    const el = document.getElementById('status-' + data.order_id);
    if (el) el.innerText = data.status;
  });
</script>
{% endif %}

{% endblock %}
