{% extends 'base.html' %}
{% block title %}Owner Orders - CanteenKart{% endblock %}
{% block content %}

<h1 class="text-2xl font-semibold mb-6">Active Orders</h1>

<form method="get" class="flex flex-wrap items-end gap-3 mb-6 bg-white/60 backdrop-blur-md shadow-md p-4 rounded-lg">
  <label class="form-control w-40">
    <div class="label"><span class="label-text">Filter by status</span></div>
    <select class="select select-bordered select-sm" name="status">
      <option value="" {{ 'selected' if (request.args.get('status') or '') == '' else '' }}>All</option>
      <option value="pending" {{ 'selected' if request.args.get('status')=='pending' else '' }}>Pending</option>
      <option value="preparing" {{ 'selected' if request.args.get('status')=='preparing' else '' }}>Preparing</option>
      <option value="ready" {{ 'selected' if request.args.get('status')=='ready' else '' }}>Ready</option>
    </select>
  </label>
  <button type="submit" class="btn btn-sm btn-primary">Apply</button>
  <span class="flex-1"></span>
  <a class="btn btn-ghost btn-sm" href="{{ url_for('owners.scanner') }}">Scanner</a>
  <a class="btn btn-ghost btn-sm" href="{{ url_for('owners.stock_page') }}">Stock</a>
  <a class="btn btn-ghost btn-sm" href="{{ url_for('owners.owner_dashboard') }}">Dashboard</a>
</form>

<div class="rounded-xl shadow-md bg-gradient-to-r from-blue-50 via-purple-50 to-pink-50 p-6">
  <h2 class="text-lg font-semibold text-gray-800 mb-4">Orders List</h2>
  <div class="overflow-x-auto bg-white/70 backdrop-blur-sm rounded-lg shadow-sm">
    <table class="table w-full">
      <thead class="bg-gradient-to-r from-indigo-100 to-pink-100">
        <tr class="text-gray-800 font-semibold">
          <th>ID</th>
          <th>Token</th>
          <th>User</th>
          <th>Pickup</th>
          <th>Status</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody>
        {% for order in orders %}
          <tr class="hover:bg-indigo-50/40 transition">
            <td>{{ order.order_id }}</td>
            <td>{{ order.token_code }}</td>
            <td>{{ order.user.name if order.user else order.user_id }}</td>
            <td>{{ order.pickup_slot or 'â€”' }}</td>
            <td id="status-{{ order.order_id }}">
              <span class="badge {% if order.status == 'pending' %}badge-warning{% elif order.status == 'preparing' %}badge-info{% elif order.status == 'ready' %}badge-success{% elif order.status == 'completed' %}badge-success{% elif order.status == 'cancelled' %}badge-error{% else %}badge-neutral{% endif %}">
                {{ order.status }}
              </span>
            </td>
            <td>
              <form action="{{ url_for('owner_orders.update_status', order_id=order.order_id) }}" method="post" class="flex items-center gap-2">
                <select class="select select-bordered select-xs" name="status">
                  <option value="pending" {% if order.status=='pending' %}selected{% endif %}>pending</option>
                  <option value="preparing" {% if order.status=='preparing' %}selected{% endif %}>preparing</option>
                  <option value="ready" {% if order.status=='ready' %}selected{% endif %}>ready</option>
                  <option value="completed" {% if order.status=='completed' %}selected{% endif %}>completed</option>
                </select>
                <button type="submit" class="btn btn-sm btn-primary">Set</button>
              </form>
            </td>
          </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
</div>

{% endblock %}
