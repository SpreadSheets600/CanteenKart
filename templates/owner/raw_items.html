{% extends 'base.html' %} {% block content %}

<h2 class="text-3xl font-bold mb-2">Raw Items Management</h2>
<p class="text-gray-600 mb-6">Manage your raw materials and inventory</p>

<div class="flex justify-between items-center mb-6">
	<div class="flex gap-2">
		<a href="{{ url_for('owners.add_raw_item') }}" class="btn btn-primary">
			<svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
				<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4" />
			</svg>
			Add Raw Item
		</a>
	</div>
	<div class="text-sm text-gray-500">Total Items: {{ raw_items|length }}</div>
</div>

<div class="grid gap-4">
	{% for item in raw_items %}
	<div class="card bg-base-200 shadow">
		<div class="card-body">
			<div class="flex justify-between items-start">
				<div class="flex-1">
					<h3 class="card-title text-lg">{{ item.name }}</h3>
					{% if item.description %}
					<p class="text-gray-600 text-sm mb-2">{{ item.description }}</p>
					{% endif %}
				</div>

				<div class="flex items-center gap-4">
					<!-- Stock Status -->
					<div class="text-right">
						<div class="text-2xl font-bold {% if item.stock_qty <= 5 %}text-error{% elif item.stock_qty <= 10 %}text-warning{% else %}text-success{% endif %}">{{ item.stock_qty }}</div>
						<div class="text-xs opacity-70">units</div>
					</div>

					<!-- Quick Actions -->
					<div class="dropdown dropdown-end">
						<div tabindex="0" role="button" class="btn btn-ghost btn-sm">
							<svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
								<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 5v.01M12 12v.01M12 19v.01M12 6a1 1 0 110-2 1 1 0 010 2zm0 7a1 1 0 110-2 1 1 0 010 2zm0 7a1 1 0 110-2 1 1 0 010 2z" />
							</svg>
						</div>
						<ul tabindex="0" class="dropdown-content z-[1] menu p-2 shadow bg-base-100 rounded-box w-52">
							<li>
								<a href="{{ url_for('owners.edit_raw_item', raw_item_id=item.raw_item_id) }}">
									<svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
										<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z" />
									</svg>
									Edit Item
								</a>
							</li>
							<li>
								<a href="#update-stock-{{ item.raw_item_id }}" onclick="document.getElementById('stock-modal-{{ item.raw_item_id }}').classList.add('modal-open')">
									<svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
										<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 7h.01M7 3h5c.512 0 1.024.195 1.414.586l7 7a2 2 0 010 2.828l-7 7a2 2 0 01-2.828 0l-7-7A1.994 1.994 0 013 12V7a4 4 0 014-4z" />
									</svg>
									Update Stock
								</a>
							</li>
							<li>
								<a href="#delete-{{ item.raw_item_id }}" onclick="document.getElementById('delete-modal-{{ item.raw_item_id }}').classList.add('modal-open')" class="text-error">
									<svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
										<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" />
									</svg>
									Delete Item
								</a>
							</li>
						</ul>
					</div>
				</div>
			</div>

			<!-- Stock Level Indicator -->
			<div class="mt-3">
				<div class="flex justify-between text-xs mb-1">
					<span>Stock Level</span>
					<span>{{ item.stock_qty }} units</span>
				</div>
				<progress class="progress {% if item.stock_qty <= 5 %}progress-error{% elif item.stock_qty <= 10 %}progress-warning{% else %}progress-success{% endif %} w-full" value="{{ item.stock_qty }}" max="50"></progress>
			</div>
		</div>
	</div>

	<!-- Update Stock Modal -->
	<div id="stock-modal-{{ item.raw_item_id }}" class="modal">
		<div class="modal-box">
			<h3 class="font-bold text-lg">Update Stock - {{ item.name }}</h3>
			<p class="py-4">Current stock: <span class="font-semibold">{{ item.stock_qty }}</span> units</p>

			<form method="post" action="{{ url_for('owners.update_raw_item_stock', raw_item_id=item.raw_item_id) }}" class="space-y-4">
				<div class="form-control">
					<label class="label">
						<span class="label-text">Quantity</span>
					</label>
					<input type="number" name="quantity" class="input input-bordered" placeholder="Enter quantity" min="1" required />
				</div>

				<div class="flex gap-2">
					<button type="submit" name="action" value="add" class="btn btn-success flex-1">
						<svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
							<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4" />
						</svg>
						Add Stock
					</button>
					<button type="submit" name="action" value="subtract" class="btn btn-warning flex-1">
						<svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
							<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20 12H4" />
						</svg>
						Remove Stock
					</button>
				</div>
			</form>

			<div class="modal-action">
				<a href="#" class="btn" onclick="document.getElementById('stock-modal-{{ item.raw_item_id }}').classList.remove('modal-open')">Close</a>
			</div>
		</div>
	</div>

	<!-- Delete Confirmation Modal -->
	<div id="delete-modal-{{ item.raw_item_id }}" class="modal">
		<div class="modal-box">
			<h3 class="font-bold text-lg text-error">Delete Raw Item</h3>
			<p class="py-4">Are you sure you want to delete <span class="font-semibold">{{ item.name }}</span>? This action cannot be undone.</p>

			<div class="modal-action">
				<form method="post" action="{{ url_for('owners.delete_raw_item', raw_item_id=item.raw_item_id) }}" class="inline">
					<button type="submit" class="btn btn-error">Delete</button>
				</form>
				<a href="#" class="btn" onclick="document.getElementById('delete-modal-{{ item.raw_item_id }}').classList.remove('modal-open')">Cancel</a>
			</div>
		</div>
	</div>
	{% else %}
	<div class="card bg-base-200 shadow">
		<div class="card-body text-center py-12">
			<div class="text-6xl mb-4">ðŸ“¦</div>
			<h3 class="text-xl font-semibold mb-2">No Raw Items Yet</h3>
			<p class="text-gray-600 mb-4">Start by adding your first raw material to track inventory.</p>
			<a href="{{ url_for('owners.add_raw_item') }}" class="btn btn-primary">Add First Item</a>
		</div>
	</div>
	{% endfor %}
</div>

{% endblock %}
