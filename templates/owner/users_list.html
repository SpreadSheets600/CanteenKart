{% extends 'base.html' %} {% block content %}
<h2>Users</h2>

<table>
	<thead>
		<tr>
			<th>ID</th>
			<th>Name</th>
			<th>Phone</th>
			<th>Orders</th>
			<th>Wallet</th>
			<table>
				<thead>
					<tr>
						<th>ID</th>
						<th>Name</th>
						<th>Phone</th>
						<th>Orders</th>
						<th>Total Spent</th>
						<th>Avg Order</th>
						<th>Last Order</th>
						<th>Wallet</th>
						<th></th>
					</tr>
				</thead>
				<tbody>
					{% for s in user_stats %}
						<tr>
							<td>{{ s.user.user_id }}</td>
							<td>{{ s.user.name }}</td>
							<td>{{ s.user.phone }}</td>
							<td>{{ s.orders_count }}</td>
							<td>{{ '%.2f'|format(s.total_spent) }}</td>
							<td>{{ '%.2f'|format(s.avg_order) }}</td>
							<td>{{ s.last_order_date or '-' }}</td>
							<td>{{ '%.2f'|format(s.wallet.balance) if s.wallet else '0.00' }}</td>
							<td><a href="{{ url_for('users.user_detail', user_id=s.user.user_id) }}">View</a></td>
						</tr>
					{% else %}
						<tr><td colspan="9">No users</td></tr>
					{% endfor %}
				</tbody>
			</table>
</table>

{% endblock %}
